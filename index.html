<!-- CHUNK 1 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackMagic ATEM Macro Editor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1e1e1e, #2d2d2d); color: #ffffff; min-height: 100vh; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #ff6b35, #f7931e); border-radius: 12px; box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3); }
        .header h1 { font-size: 2.5rem; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { margin-top: 10px; opacity: 0.9; font-size: 1.1rem; }
        .main-content { display: grid; grid-template-columns: 1fr 2fr 300px; gap: 20px; margin-bottom: 30px; }
        .panel { background: rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }
        .panel h2 { color: #ff6b35; margin-bottom: 20px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .macro-list { max-height: 500px; overflow-y: auto; margin-bottom: 20px; }
        .macro-item { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 15px; margin-bottom: 10px; cursor: grab; transition: all 0.3s ease; position: relative; }
        .macro-item:active { cursor: grabbing; }
        .macro-item:hover { background: rgba(255, 107, 53, 0.2); border-color: #ff6b35; transform: translateY(-2px); }
        .macro-item.active { background: rgba(255, 107, 53, 0.3); border-color: #ff6b35; }
        .macro-item.dragging { opacity: 0.5; transform: rotate(5deg); }
        .macro-item h3 { font-size: 1.1rem; margin-bottom: 5px; padding-right: 80px; }
        .macro-item p { opacity: 0.7; font-size: 0.9rem; }
        .macro-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; }
        .macro-index { position: absolute; top: 5px; left: 5px; background: #ff6b35; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .btn { background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(255, 107, 53, 0.4); }
        .btn-small { padding: 5px 10px; font-size: 0.8rem; }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-danger:hover { box-shadow: 0 4px 16px rgba(231, 76, 60, 0.4); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #ff6b35; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; color: white; font-size: 1rem; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #ff6b35; box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2); }
        .command-list { max-height: 400px; overflow-y: auto; background: rgba(0, 0, 0, 0.2); border-radius: 6px; padding: 10px; }
        .command-item { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; padding: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .command-info { flex-grow: 1; }
        .command-type { background: #ff6b35; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 10px; }
        .add-command { display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 15px; align-items: end; }
        .export-import { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .status-bar { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; text-align: center; margin-top: 20px; }
        .input-list { max-height: 300px; overflow-y: auto; margin-bottom: 15px; }
        .input-item { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 4px; padding: 8px 12px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        .input-item input { background: transparent; border: none; color: white; flex-grow: 1; margin-right: 10px; padding: 4px; }
        .input-item input:focus { outline: 1px solid #ff6b35; }
        .add-input { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; }
        .add-input input { flex: 1; min-width: 0; }
        .add-input .btn-small { flex-shrink: 0; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #2d2d2d; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal h3 { color: #ff6b35; margin-bottom: 20px; }
        @media (max-width: 1200px) { .main-content { grid-template-columns: 1fr 1fr; gap: 20px; } .panel:last-child { grid-column: 1 / -1; } }
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; gap: 20px; } .header h1 { font-size: 2rem; } .add-command { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé• BlackMagic ATEM Macro Editor</h1>
            <p>Create and manage macros for your ATEM video switcher</p>
        </div>
        <div class="main-content">
            <div class="panel">
                <h2>üìã Macro Library</h2>
                <div class="macro-list" id="macroList"></div>
                <button class="btn" onclick="createNewMacro()">‚ûï New Macro</button>
                <div class="export-import">
                    <button class="btn" onclick="exportMacrosXML()">üíæ Export XML</button>
                    <button class="btn" onclick="importMacrosXML()">üìÅ Import XML</button>
                    <button class="btn" onclick="exportMacrosJSON()">üíæ Export JSON</button>
                    <button class="btn" onclick="importMacrosJSON()">üìÅ Import JSON</button>
                    <input type="file" id="importFile" accept=".xml,.json" style="display: none;" onchange="handleImport(event)">
                </div>
            </div>
            <div class="panel">
                <h2>‚öôÔ∏è Macro Editor</h2>
                <div id="macroEditor">
                    <div class="form-group">
                        <label for="macroIndex">Macro Index</label>
                        <input type="number" id="macroIndex" min="0" max="99" placeholder="0-99">
                    </div>
                    <div class="form-group">
                        <label for="macroName">Macro Name</label>
                        <input type="text" id="macroName" placeholder="Enter macro name">
                    </div>
                    <div class="form-group">
                        <label for="macroDescription">Description</label>
                        <textarea id="macroDescription" rows="2" placeholder="Optional description"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Commands</label>
                        <div class="add-command">
                            <select id="commandType">
                                <option value="PreviewInput">Preview Input</option>
                                <option value="AutoTransition">Auto Transition</option>
                                <option value="CutTransition">Cut Transition</option>
                                <option value="AuxiliaryInput">Auxiliary Input</option>
                                <option value="KeyOnAir">Key On/Off</option>
                                <option value="DownstreamKeyOnAir">DSK On/Off</option>
                                <option value="DownstreamKeyAuto">DSK Auto</option>
                                <option value="TransitionSource">Transition Source</option>
                                <option value="FlyKeyRunToKeyFrame">Fly Key</option>
                                <option value="HyperDeckRecord">HyperDeck Record</option>
                                <option value="HyperDeckStop">HyperDeck Stop</option>
                                <option value="MacroSleep">Sleep/Delay</option>
                            </select>
                            <select id="commandValue"></select>
                            <button class="btn" onclick="addCommand()">Add</button>
                        </div>
                        <div class="command-list" id="commandList"></div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                        <button class="btn" onclick="saveMacro()">üíæ Save Macro</button>
                        <button class="btn btn-danger" onclick="deleteMacro()" id="deleteBtn" style="display: none;">üóëÔ∏è Delete</button>
                    </div>
                </div>
            </div>
<!-- CHUNK 2 -->
<div class="panel">
                <h2>üéõÔ∏è Input Configuration</h2>
                <div class="add-input">
                    <input type="text" id="newInputId" placeholder="Input ID (e.g., Camera1)">
                    <input type="text" id="newInputName" placeholder="Display Name">
                    <button class="btn btn-small" onclick="addInput()">Add</button>
                </div>
                <div class="input-list" id="inputList"></div>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn btn-small" onclick="resetToDefaults()">Reset to Defaults</button>
                    <button class="btn btn-small" onclick="importInputs()">üìÅ Import Inputs</button>
                    <button class="btn btn-small" onclick="exportInputs()">üíæ Export Inputs</button>
                    <button class="btn btn-small" onclick="showInputTemplates()">üìã Templates</button>
                </div>
                <input type="file" id="inputImportFile" accept=".txt,.csv,.json" style="display: none;" onchange="handleInputImport(event)">
                
                <h2 style="margin-top: 30px;">üîå Aux Output Configuration</h2>
                <div class="input-list" id="auxList"></div>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn btn-small" onclick="resetAuxToDefaults()">Reset Aux Names</button>
                    <button class="btn btn-small" onclick="importAuxNames()">üìÅ Import Aux</button>
                    <button class="btn btn-small" onclick="exportAuxNames()">üíæ Export Aux</button>
                </div>
                <input type="file" id="auxImportFile" accept=".txt,.csv,.json" style="display: none;" onchange="handleAuxImport(event)">
            </div>
        </div>
        <div class="status-bar" id="statusBar">Ready to create macros</div>
    </div>
    <div class="modal" id="renameModal">
        <div class="modal-content">
            <h3>Rename Macro</h3>
            <div class="form-group">
                <label for="newMacroName">New Name</label>
                <input type="text" id="newMacroName" placeholder="Enter new name">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn" onclick="confirmRename()">Rename</button>
                <button class="btn btn-danger" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>
    <div class="modal" id="inputTemplatesModal">
        <div class="modal-content">
            <h3>Input Templates</h3>
            <p>Choose a template to quickly set up common ATEM configurations:</p>
            <div style="margin: 20px 0;">
                <button class="btn" onclick="loadInputTemplate('constellation8k')" style="width: 100%; margin-bottom: 10px;">ATEM Constellation 8K (40 inputs)</button>
                <button class="btn" onclick="loadInputTemplate('mini')" style="width: 100%; margin-bottom: 10px;">ATEM Mini/Mini Pro (8 inputs)</button>
                <button class="btn" onclick="loadInputTemplate('television')" style="width: 100%; margin-bottom: 10px;">ATEM Television Studio (20 inputs)</button>
                <button class="btn" onclick="loadInputTemplate('production')" style="width: 100%; margin-bottom: 10px;">ATEM Production Studio (20 inputs)</button>
            </div>
            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                <h4 style="color: #ff6b35; margin-bottom: 10px;">Import Format Examples:</h4>
                <div style="font-family: monospace; font-size: 0.9rem; line-height: 1.4;">
                    <strong>Text/CSV Format:</strong><br>
                    Camera1,Main Camera<br>
                    Camera2,Stage Left<br>
                    Camera3,Stage Right<br>
                    MediaPlayer1,Graphics Computer<br>
                    <br>
                    <strong>JSON Format:</strong><br>
                    {<br>
                    &nbsp;&nbsp;"Camera1": "Main Camera",<br>
                    &nbsp;&nbsp;"Camera2": "Stage Left",<br>
                    &nbsp;&nbsp;"MediaPlayer1": "Graphics"<br>
                    }
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-danger" onclick="closeInputTemplatesModal()">Close</button>
            </div>
        </div>
    </div>
    <script>
<!-- CHUNK 3 -->
let macros=[],currentMacroId=null,nextMacroId=1,renamingMacroId=null,inputs={},atemProfile={majorVersion:"2",minorVersion:"1",product:"ATEM Constellation 8K (4K Mode)"};
const defaultInputs={Black:"Black",Camera1:"Camera 1",Camera2:"Camera 2",Camera3:"Camera 3",Camera4:"Camera 4",Camera5:"Camera 5",Camera6:"Camera 6",Camera17:"Camera 17",Camera20:"Camera 20",Camera22:"Camera 22",Camera23:"Camera 23",Camera25:"Camera 25",Camera26:"Camera 26",Camera27:"Camera 27",Camera28:"Camera 28",Camera35:"Camera 35",Camera38:"Camera 38",Camera39:"Camera 39",MediaPlayer1:"Media Player 1",MediaPlayer2:"Media Player 2",SuperSource:"Super Source",SuperSource2:"Super Source 2",ME1Program:"ME1 Program",ME2Program:"ME2 Program",ME3Program:"ME3 Program",ME4Program:"ME4 Program"};
let auxNames={};const defaultAuxNames={0:"Aux 0",1:"Aux 1",2:"Aux 2",3:"Aux 3",4:"Aux 4",5:"Aux 5",6:"Aux 6",7:"Aux 7",8:"Aux 8",9:"Aux 9",10:"Aux 10",11:"Aux 11",12:"Aux 12",13:"Aux 13",14:"Aux 14",15:"Aux 15",16:"Aux 16",17:"Aux 17",18:"Aux 18",19:"Aux 19",20:"Aux 20",21:"Aux 21",22:"Aux 22",23:"Aux 23"};
let tempCommands=[];

function initializeApp(){inputs={...defaultInputs};auxNames={...defaultAuxNames};renderInputList();renderAuxList();updateCommandValueOptions();createNewMacro()}

function renderMacroList(){const list=document.getElementById("macroList");list.innerHTML="";[...macros].sort((a,b)=>a.index-b.index).forEach(macro=>{const item=document.createElement("div");item.className=`macro-item ${currentMacroId===macro.id?"active":""}`;item.draggable=true;item.dataset.macroId=macro.id;item.onclick=()=>selectMacro(macro.id);item.innerHTML=`<div class="macro-index">${macro.index}</div><div class="macro-actions"><button class="btn btn-small" onclick="event.stopPropagation(); renameMacro(${macro.id})" title="Rename">‚úèÔ∏è</button><button class="btn btn-small" onclick="event.stopPropagation(); duplicateMacro(${macro.id})" title="Duplicate">üìã</button><button class="btn btn-small btn-danger" onclick="event.stopPropagation(); deleteMacroFromList(${macro.id})" title="Delete">üóëÔ∏è</button></div><h3>${macro.name}</h3><p>${macro.description||"No description"}</p><p style="font-size: 0.8rem; margin-top: 5px; opacity: 0.6;">${macro.commands.length} commands</p>`;item.addEventListener("dragstart",handleDragStart);item.addEventListener("dragend",handleDragEnd);item.addEventListener("dragover",handleDragOver);item.addEventListener("drop",handleDrop);list.appendChild(item)})}

function renderInputList(){const list=document.getElementById("inputList");list.innerHTML="";Object.entries(inputs).forEach(([id,name])=>{const item=document.createElement("div");item.className="input-item";item.innerHTML=`<input type="text" value="${name}" onchange="updateInput('${id}', this.value)"><button class="btn btn-small btn-danger" onclick="removeInput('${id}')">‚úï</button>`;list.appendChild(item)})}

function addInput(){const id=document.getElementById("newInputId").value.trim();const name=document.getElementById("newInputName").value.trim();if(!id||!name){updateStatus("Please enter both input ID and name",true);return}inputs[id]=name;document.getElementById("newInputId").value="";document.getElementById("newInputName").value="";renderInputList();updateCommandValueOptions();updateStatus(`Added input: ${name}`)}

function updateInput(id,newName){if(newName.trim()){inputs[id]=newName.trim();updateCommandValueOptions()}}

function removeInput(id){delete inputs[id];renderInputList();updateCommandValueOptions();updateStatus("Input removed")}

function resetToDefaults(){inputs={...defaultInputs};renderInputList();updateCommandValueOptions();updateStatus("Reset to default inputs")}

function importInputs(){document.getElementById("inputImportFile").click()}

function exportInputs(){const inputsText=Object.entries(inputs).map(([id,name])=>`${id},${name}`).join("\n");try{const blob=new Blob([inputsText],{type:"text/plain"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="atem_inputs.csv";document.body.appendChild(link);link.click();document.body.removeChild(link);updateStatus("Inputs exported as CSV")}catch(error){showTextModal("Export Inputs - Copy the content below:",inputsText)}}

function showInputTemplates(){document.getElementById("inputTemplatesModal").style.display="flex"}

function closeInputTemplatesModal(){document.getElementById("inputTemplatesModal").style.display="none"}

function handleInputImport(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){try{const content=e.target.result;if(file.name.endsWith(".json")){parseInputsJSON(content)}else{parseInputsCSV(content)}}catch(error){updateStatus("Error importing inputs: "+error.message,true)}};reader.readAsText(file)}

function parseInputsJSON(jsonString){const importedInputs=JSON.parse(jsonString);if(typeof importedInputs!=="object"){throw new Error("Invalid JSON format - expected object with input mappings")}let count=0;Object.entries(importedInputs).forEach(([id,name])=>{if(typeof id==="string"&&typeof name==="string"){inputs[id]=name;count++}});renderInputList();updateCommandValueOptions();updateStatus(`Imported ${count} inputs from JSON`)}

function parseInputsCSV(csvContent){const lines=csvContent.split("\n").filter(line=>line.trim());let count=0;lines.forEach(line=>{const parts=line.split(",");if(parts.length>=2){const id=parts[0].trim();const name=parts.slice(1).join(",").trim();if(id&&name){inputs[id]=name;count++}}});renderInputList();updateCommandValueOptions();updateStatus(`Imported ${count} inputs from CSV/Text`)}

function loadInputTemplate(templateType){let templateInputs={};switch(templateType){case"constellation8k":templateInputs={Black:"Black",Camera1:"Camera 1",Camera2:"Camera 2",Camera3:"Camera 3",Camera4:"Camera 4",Camera5:"Camera 5",Camera6:"Camera 6",Camera7:"Camera 7",Camera8:"Camera 8",Camera9:"Camera 9",Camera10:"Camera 10",Camera11:"Camera 11",Camera12:"Camera 12",Camera13:"Camera 13",Camera14:"Camera 14",Camera15:"Camera 15",Camera16:"Camera 16",Camera17:"Camera 17",Camera18:"Camera 18",Camera19:"Camera 19",Camera20:"Camera 20",Camera21:"Camera 21",Camera22:"Camera 22",Camera23:"Camera 23",Camera24:"Camera 24",Camera25:"Camera 25",Camera26:"Camera 26",Camera27:"Camera 27",Camera28:"Camera 28",Camera29:"Camera 29",Camera30:"Camera 30",Camera31:"Camera 31",Camera32:"Camera 32",Camera33:"Camera 33",Camera34:"Camera 34",Camera35:"Camera 35",Camera36:"Camera 36",Camera37:"Camera 37",Camera38:"Camera 38",Camera39:"Camera 39",Camera40:"Camera 40",MediaPlayer1:"Media Player 1",MediaPlayer2:"Media Player 2",MediaPlayer3:"Media Player 3",MediaPlayer4:"Media Player 4",SuperSource:"Super Source",SuperSource2:"Super Source 2",ME1Program:"ME1 Program",ME2Program:"ME2 Program",ME3Program:"ME3 Program",ME4Program:"ME4 Program"};break;case"mini":templateInputs={Black:"Black",Camera1:"HDMI 1",Camera2:"HDMI 2",Camera3:"HDMI 3",Camera4:"HDMI 4",Camera5:"HDMI 5",Camera6:"HDMI 6",Camera7:"HDMI 7",Camera8:"HDMI 8",MediaPlayer1:"Media Player 1",MediaPlayer2:"Media Player 2"};break;case"television":templateInputs={Black:"Black",Camera1:"SDI 1",Camera2:"SDI 2",Camera3:"SDI 3",Camera4:"SDI 4",Camera5:"SDI 5",Camera6:"SDI 6",Camera7:"SDI 7",Camera8:"SDI 8",Camera9:"HDMI 1",Camera10:"HDMI 2",Camera11:"HDMI 3",Camera12:"HDMI 4",Camera13:"Component",Camera14:"Composite",Camera15:"S-Video",Camera16:"Internal 1",Camera17:"Internal 2",Camera18:"Internal 3",Camera19:"Internal 4",Camera20:"Internal 5",MediaPlayer1:"Media Player 1",MediaPlayer2:"Media Player 2"};break;case"production":templateInputs={Black:"Black",Camera1:"SDI 1",Camera2:"SDI 2",Camera3:"SDI 3",Camera4:"SDI 4",Camera5:"SDI 5",Camera6:"SDI 6",Camera7:"SDI 7",Camera8:"SDI 8",Camera9:"SDI 9",Camera10:"SDI 10",Camera11:"SDI 11",Camera12:"SDI 12",Camera13:"SDI 13",Camera14:"SDI 14",Camera15:"SDI 15",Camera16:"SDI 16",Camera17:"SDI 17",Camera18:"SDI 18",Camera19:"SDI 19",Camera20:"SDI 20",MediaPlayer1:"Media Player 1",MediaPlayer2:"Media Player 2",SuperSource:"Super Source"};break}inputs={...inputs,...templateInputs};renderInputList();updateCommandValueOptions();closeInputTemplatesModal();updateStatus(`Loaded ${Object.keys(templateInputs).length} inputs from ${templateType} template`)}

function showTextModal(title,content){const modal=document.createElement("div");modal.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center;";const modalContent=document.createElement("div");modalContent.style.cssText="background: #2d2d2d; padding: 30px; border-radius: 12px; max-width: 80%; max-height: 80%; overflow: auto; color: white;";modalContent.innerHTML=`<h3 style="color: #ff6b35; margin-bottom: 20px;">${title}</h3><textarea readonly style="width: 100%; height: 300px; background: #1e1e1e; color: white; border: 1px solid #ff6b35; border-radius: 6px; padding: 10px; font-family: monospace; font-size: 12px;">${content}</textarea><div style="margin-top: 15px; text-align: right;"><button onclick="copyToClipboard(this)" style="background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-right: 10px;">Copy to Clipboard</button><button onclick="this.closest('.modal-temp').remove()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Close</button></div>`;modal.className="modal-temp";modal.appendChild(modalContent);document.body.appendChild(modal);const textarea=modalContent.querySelector("textarea");textarea.focus();textarea.select()}

function renderAuxList(){const list=document.getElementById("auxList");list.innerHTML="";Object.entries(auxNames).sort((a,b)=>parseInt(a[0])-parseInt(b[0])).forEach(([id,name])=>{const item=document.createElement("div");item.className="input-item";item.innerHTML=`<strong style="color: #ff6b35; min-width: 60px;">Aux ${id}:</strong><input type="text" value="${name}" onchange="updateAux('${id}', this.value)">`;list.appendChild(item)})}

function updateAux(id,newName){if(newName.trim()){auxNames[id]=newName.trim();updateCommandValueOptions()}}

function resetAuxToDefaults(){auxNames={...defaultAuxNames};renderAuxList();updateCommandValueOptions();updateStatus("Reset aux names to defaults")}

function importAuxNames(){document.getElementById("auxImportFile").click()}

function exportAuxNames(){const auxText=Object.entries(auxNames).sort((a,b)=>parseInt(a[0])-parseInt(b[0])).map(([id,name])=>`${id},${name}`).join("\n");try{const blob=new Blob([auxText],{type:"text/plain"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="atem_aux_names.csv";document.body.appendChild(link);link.click();document.body.removeChild(link);updateStatus("Aux names exported as CSV")}catch(error){showTextModal("Export Aux Names - Copy the content below:",auxText)}}

function handleAuxImport(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){try{const content=e.target.result;if(file.name.endsWith(".json")){parseAuxJSON(content)}else{parseAuxCSV(content)}}catch(error){updateStatus("Error importing aux names: "+error.message,true)}};reader.readAsText(file)}

function parseAuxJSON(jsonString){const importedAux=JSON.parse(jsonString);if(typeof importedAux!=="object"){throw new Error("Invalid JSON format - expected object with aux mappings")}let count=0;Object.entries(importedAux).forEach(([id,name])=>{if(typeof name==="string"){auxNames[id]=name;count++}});renderAuxList();updateCommandValueOptions();updateStatus(`Imported ${count} aux names from JSON`)}

function parseAuxCSV(csvContent){const lines=csvContent.split("\n").filter(line=>line.trim());let count=0;lines.forEach(line=>{const parts=line.split(",");if(parts.length>=2){const id=parts[0].trim();const name=parts.slice(1).join(",").trim();if(id&&name){auxNames[id]=name;count++}}});renderAuxList();updateCommandValueOptions();updateStatus(`Imported ${count} aux names from CSV/Text`)}

let draggedMacro=null;function handleDragStart(e){draggedMacro=e.target;e.target.classList.add("dragging")}function handleDragEnd(e){e.target.classList.remove("dragging");draggedMacro=null}function handleDragOver(e){e.preventDefault()}function handleDrop(e){e.preventDefault();if(!draggedMacro||draggedMacro===e.target)return;const draggedId=parseInt(draggedMacro.dataset.macroId);const targetId=parseInt(e.target.dataset.macroId);const draggedMacroObj=macros.find(m=>m.id===draggedId);const targetMacroObj=macros.find(m=>m.id===targetId);if(draggedMacroObj&&targetMacroObj){const tempIndex=draggedMacroObj.index;draggedMacroObj.index=targetMacroObj.index;targetMacroObj.index=tempIndex;renderMacroList();updateStatus("Macro order changed")}}

function selectMacro(id){currentMacroId=id;const macro=macros.find(m=>m.id===id);document.getElementById("macroIndex").value=macro.index;document.getElementById("macroName").value=macro.name;document.getElementById("macroDescription").value=macro.description||"";document.getElementById("deleteBtn").style.display="inline-block";renderCommandList(macro.commands);renderMacroList();updateStatus(`Selected macro: ${macro.name}`)}

function renderCommandList(commands=[]){const list=document.getElementById("commandList");list.innerHTML="";commands.forEach((command,index)=>{const item=document.createElement("div");item.className="command-item";item.innerHTML=`<div class="command-info"><span class="command-type">${command.type}</span>${generateCommandLabel(command)}</div><button class="btn btn-small btn-danger" onclick="removeCommand(${index})">‚úï</button>`;list.appendChild(item)})}

function generateCommandLabel(command){const{type,attributes}=command;switch(type){case"PreviewInput":return`ME${attributes.mixEffectBlockIndex||0}: Preview ‚Üí ${inputs[attributes.input]||attributes.input}`;case"AutoTransition":return`ME${attributes.mixEffectBlockIndex||0}: Auto Transition`;case"CutTransition":return`ME${attributes.mixEffectBlockIndex||0}: Cut Transition`;case"AuxiliaryInput":return`${auxNames[attributes.auxiliaryIndex]||"Aux "+attributes.auxiliaryIndex}: ‚Üí ${inputs[attributes.input]||attributes.input}`;case"KeyOnAir":return`ME${attributes.mixEffectBlockIndex||0} Key ${attributes.keyIndex}: ${attributes.onAir==="True"?"ON":"OFF"}`;case"DownstreamKeyOnAir":return`DSK ${attributes.keyIndex}: ${attributes.onAir==="True"?"ON":"OFF"}`;case"DownstreamKeyAuto":return`DSK ${attributes.keyIndex}: Auto`;case"TransitionSource":return`ME${attributes.mixEffectBlockIndex||0}: Transition ‚Üí ${attributes.source}`;case"FlyKeyRunToKeyFrame":return`ME${attributes.mixEffectBlockIndex||0} Fly Key ${attributes.keyIndex}: ‚Üí Frame ${attributes.keyFrameIndex}`;case"HyperDeckRecord":return`HyperDeck ${attributes.hyperDeckIndex}: Record`;case"HyperDeckStop":return`HyperDeck ${attributes.hyperDeckIndex}: Stop`;case"MacroSleep":return`Sleep: ${attributes.frames} frames`;default:return JSON.stringify(attributes)}}

function createNewMacro(){currentMacroId=null;tempCommands=[];const usedIndices=macros.map(m=>m.index);let nextIndex=0;while(usedIndices.includes(nextIndex)){nextIndex++}document.getElementById("macroIndex").value=nextIndex;document.getElementById("macroName").value="";document.getElementById("macroDescription").value="";document.getElementById("deleteBtn").style.display="none";renderCommandList([]);renderMacroList();updateStatus("Creating new macro")}

function addCommand(){const type=document.getElementById("commandType").value;const valueSelect=document.getElementById("commandValue");const value=valueSelect.value;let attributes={};switch(type){case"PreviewInput":case"AutoTransition":case"CutTransition":attributes.mixEffectBlockIndex=value.split("-")[0]||"0";if(type==="PreviewInput"){attributes.input=value.split("-")[1]||value}break;case"AuxiliaryInput":const auxParts=value.split("-");attributes.auxiliaryIndex=auxParts[0]||"0";attributes.input=auxParts[1]||"Black";break;case"KeyOnAir":const keyParts=value.split("-");attributes.mixEffectBlockIndex=keyParts[0]||"0";attributes.keyIndex=keyParts[1]||"0";attributes.onAir=keyParts[2]||"True";break;case"DownstreamKeyOnAir":case"DownstreamKeyAuto":attributes.keyIndex=value||"0";if(type==="DownstreamKeyOnAir"){attributes.onAir="True"}break;case"TransitionSource":const transParts=value.split("-");attributes.mixEffectBlockIndex=transParts[0]||"0";attributes.source=transParts[1]||"Background";break;case"FlyKeyRunToKeyFrame":const flyParts=value.split("-");attributes.mixEffectBlockIndex=flyParts[0]||"0";attributes.keyIndex=flyParts[1]||"0";attributes.keyFrameIndex=flyParts[2]||"0";break;case"HyperDeckRecord":case"HyperDeckStop":attributes.hyperDeckIndex=value||"0";break;case"MacroSleep":attributes.frames=value||"30";break}const command={type,attributes};if(currentMacroId){const macro=macros.find(m=>m.id===currentMacroId);macro.commands.push(command);renderCommandList(macro.commands)}else{tempCommands.push(command);renderCommandList(tempCommands)}updateStatus(`Added ${type} command`)}

function getCurrentCommands(){if(currentMacroId){return macros.find(m=>m.id===currentMacroId).commands}return tempCommands}

function removeCommand(index){if(currentMacroId){const macro=macros.find(m=>m.id===currentMacroId);macro.commands.splice(index,1);renderCommandList(macro.commands)}else{tempCommands.splice(index,1);renderCommandList(tempCommands)}updateStatus("Removed command")}
<!-- CHUNK 4 -->
function saveMacro(){const index=parseInt(document.getElementById("macroIndex").value);const name=document.getElementById("macroName").value.trim();const description=document.getElementById("macroDescription").value.trim();if(!name){updateStatus("Please enter a macro name",true);return}if(isNaN(index)||index<0||index>99){updateStatus("Macro index must be between 0 and 99",true);return}const existingMacro=macros.find(m=>m.index===index&&m.id!==currentMacroId);if(existingMacro){updateStatus(`Index ${index} already used by "${existingMacro.name}"`,true);return}if(currentMacroId){const macro=macros.find(m=>m.id===currentMacroId);macro.index=index;macro.name=name;macro.description=description;updateStatus(`Updated macro: ${name}`)}else{const newMacro={id:nextMacroId++,index,name,description,commands:[...tempCommands]};macros.push(newMacro);currentMacroId=newMacro.id;document.getElementById("deleteBtn").style.display="inline-block";updateStatus(`Created macro: ${name}`)}renderMacroList()}

function deleteMacro(){if(!currentMacroId)return;if(confirm("Are you sure you want to delete this macro?")){macros=macros.filter(m=>m.id!==currentMacroId);createNewMacro();updateStatus("Macro deleted")}}

function deleteMacroFromList(id){if(confirm("Are you sure you want to delete this macro?")){macros=macros.filter(m=>m.id!==id);if(currentMacroId===id){createNewMacro()}renderMacroList();updateStatus("Macro deleted")}}

function duplicateMacro(id){const macro=macros.find(m=>m.id===id);const usedIndices=macros.map(m=>m.index);let nextIndex=macro.index+1;while(usedIndices.includes(nextIndex)&&nextIndex<=99){nextIndex++}if(nextIndex>99){nextIndex=0;while(usedIndices.includes(nextIndex)&&nextIndex<=99){nextIndex++}}if(nextIndex>99){updateStatus("No available macro slots",true);return}const newMacro={...macro,id:nextMacroId++,index:nextIndex,name:macro.name+" (Copy)",commands:JSON.parse(JSON.stringify(macro.commands))};macros.push(newMacro);renderMacroList();updateStatus(`Duplicated macro: ${macro.name}`)}

function renameMacro(id){renamingMacroId=id;const macro=macros.find(m=>m.id===id);document.getElementById("newMacroName").value=macro.name;document.getElementById("renameModal").style.display="flex"}

function confirmRename(){const newName=document.getElementById("newMacroName").value.trim();if(!newName){updateStatus("Please enter a name",true);return}const macro=macros.find(m=>m.id===renamingMacroId);macro.name=newName;if(currentMacroId===renamingMacroId){document.getElementById("macroName").value=newName}renderMacroList();closeModal();updateStatus(`Renamed macro to: ${newName}`)}

function closeModal(){document.getElementById("renameModal").style.display="none";renamingMacroId=null}

function exportMacrosXML(){const xml=generateATEMXML();try{const blob=new Blob([xml],{type:"text/plain"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="atem_macros.xml";document.body.appendChild(link);link.click();document.body.removeChild(link);updateStatus("Macros exported as XML")}catch(error){showXMLModal(xml)}}

function showXMLModal(xml){const modal=document.createElement("div");modal.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center;";const content=document.createElement("div");content.style.cssText="background: #2d2d2d; padding: 30px; border-radius: 12px; max-width: 80%; max-height: 80%; overflow: auto; color: white;";content.innerHTML=`<h3 style="color: #ff6b35; margin-bottom: 20px;">Export XML - Copy the content below:</h3><textarea readonly style="width: 100%; height: 400px; background: #1e1e1e; color: white; border: 1px solid #ff6b35; border-radius: 6px; padding: 10px; font-family: monospace; font-size: 12px;">${xml}</textarea><div style="margin-top: 15px; text-align: right;"><button onclick="copyToClipboard(this)" style="background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-right: 10px;">Copy to Clipboard</button><button onclick="this.closest('.modal-temp').remove()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Close</button></div>`;modal.className="modal-temp";modal.appendChild(content);document.body.appendChild(modal);const textarea=content.querySelector("textarea");textarea.focus();textarea.select();updateStatus("XML ready for copy - download blocked by browser")}

function copyToClipboard(button){const textarea=button.closest("div").previousElementSibling;textarea.select();try{document.execCommand("copy");button.textContent="Copied!";setTimeout(()=>{button.textContent="Copy to Clipboard"},2000)}catch(err){updateStatus("Please manually copy the XML content",true)}}

function exportMacrosJSON(){const exportData={macros,inputs,auxNames,atemProfile};const dataStr=JSON.stringify(exportData,null,2);const dataBlob=new Blob([dataStr],{type:"application/json"});const link=document.createElement("a");link.href=URL.createObjectURL(dataBlob);link.download="atem_macros.json";link.click();updateStatus("Macros exported as JSON")}

function generateATEMXML(){let xml=`<?xml version="1.0" encoding="UTF-8"?>\n`;xml+=`<Profile majorVersion="${atemProfile.majorVersion}" minorVersion="${atemProfile.minorVersion}" product="${atemProfile.product}">\n`;xml+=`    <MacroPool>\n`;const sortedMacros=[...macros].sort((a,b)=>a.index-b.index);sortedMacros.forEach(macro=>{xml+=`        <Macro index="${macro.index}" name="${escapeXML(macro.name)}" description="${escapeXML(macro.description||"")}">\n`;macro.commands.forEach(command=>{xml+=`            <Op id="${command.type}"`;Object.entries(command.attributes).forEach(([key,value])=>{xml+=` ${key}="${escapeXML(value)}"`});xml+=`/>\n`});xml+=`        </Macro>\n`});xml+=`    </MacroPool>\n`;xml+=`    <MacroControl loop="False"/>\n`;xml+=`</Profile>`;return xml}

function escapeXML(str){return str.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}

function importMacrosXML(){document.getElementById("importFile").accept=".xml";document.getElementById("importFile").click()}

function importMacrosJSON(){document.getElementById("importFile").accept=".json";document.getElementById("importFile").click()}

function handleImport(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){try{if(file.name.endsWith(".xml")){parseATEMXML(e.target.result)}else if(file.name.endsWith(".json")){parseATEMJSON(e.target.result)}}catch(error){updateStatus("Error importing file: "+error.message,true)}};reader.readAsText(file)}

function parseATEMXML(xmlString){const parser=new DOMParser();const doc=parser.parseFromString(xmlString,"text/xml");const parseError=doc.querySelector("parsererror");if(parseError){throw new Error("Invalid XML format")}const profile=doc.querySelector("Profile");if(profile){atemProfile.majorVersion=profile.getAttribute("majorVersion")||"2";atemProfile.minorVersion=profile.getAttribute("minorVersion")||"1";atemProfile.product=profile.getAttribute("product")||"ATEM Constellation 8K (4K Mode)"}const macroElements=doc.querySelectorAll("Macro");const importedMacros=[];macroElements.forEach(macroEl=>{const index=parseInt(macroEl.getAttribute("index"))||0;const name=macroEl.getAttribute("name")||"";const description=macroEl.getAttribute("description")||"";const commands=[];const opElements=macroEl.querySelectorAll("Op");opElements.forEach(opEl=>{const type=opEl.getAttribute("id");const attributes={};Array.from(opEl.attributes).forEach(attr=>{if(attr.name!=="id"){attributes[attr.name]=attr.value}});commands.push({type,attributes})});importedMacros.push({id:nextMacroId++,index,name,description,commands})});importedMacros.forEach(importedMacro=>{const existingIndex=macros.findIndex(m=>m.index===importedMacro.index);if(existingIndex!==-1){macros[existingIndex]=importedMacro}else{macros.push(importedMacro)}});renderMacroList();updateStatus(`Imported ${importedMacros.length} macros from XML`)}

function parseATEMJSON(jsonString){const data=JSON.parse(jsonString);if(data.macros){const importedMacros=data.macros;const maxId=Math.max(...macros.concat(importedMacros).map(m=>m.id),0);nextMacroId=maxId+1;importedMacros.forEach(importedMacro=>{const existingIndex=macros.findIndex(m=>m.index===importedMacro.index);if(existingIndex!==-1){macros[existingIndex]=importedMacro}else{macros.push(importedMacro)}})}if(data.inputs){inputs={...inputs,...data.inputs};renderInputList();updateCommandValueOptions()}if(data.auxNames){auxNames={...auxNames,...data.auxNames};renderAuxList();updateCommandValueOptions()}if(data.atemProfile){atemProfile={...atemProfile,...data.atemProfile}}renderMacroList();updateStatus(`Imported ${data.macros?.length||0} macros from JSON`)}

function updateCommandValueOptions(){const commandType=document.getElementById("commandType").value;const valueSelect=document.getElementById("commandValue");valueSelect.innerHTML="";switch(commandType){case"PreviewInput":for(let me=0;me<4;me++){Object.entries(inputs).forEach(([id,name])=>{const option=document.createElement("option");option.value=`${me}-${id}`;option.textContent=`ME${me}: ${name}`;valueSelect.appendChild(option)})}break;case"AutoTransition":case"CutTransition":for(let me=0;me<4;me++){const option=document.createElement("option");option.value=me.toString();option.textContent=`ME${me}`;valueSelect.appendChild(option)}break;case"AuxiliaryInput":for(let aux=0;aux<24;aux++){Object.entries(inputs).forEach(([id,name])=>{const option=document.createElement("option");option.value=`${aux}-${id}`;option.textContent=`${auxNames[aux]||"Aux "+aux}: ${name}`;valueSelect.appendChild(option)})}break;case"KeyOnAir":for(let me=0;me<4;me++){for(let key=0;key<4;key++){["True","False"].forEach(state=>{const option=document.createElement("option");option.value=`${me}-${key}-${state}`;option.textContent=`ME${me} Key${key}: ${state==="True"?"ON":"OFF"}`;valueSelect.appendChild(option)})}}break;case"DownstreamKeyOnAir":case"DownstreamKeyAuto":for(let dsk=0;dsk<4;dsk++){const option=document.createElement("option");option.value=dsk.toString();option.textContent=`DSK ${dsk}`;valueSelect.appendChild(option)}break;case"TransitionSource":for(let me=0;me<4;me++){["Background","Key1","Key2","Key3","Key4","Background, Key1","Background, Key2"].forEach(source=>{const option=document.createElement("option");option.value=`${me}-${source}`;option.textContent=`ME${me}: ${source}`;valueSelect.appendChild(option)})}break;case"FlyKeyRunToKeyFrame":for(let me=0;me<4;me++){for(let key=0;key<4;key++){for(let frame=0;frame<2;frame++){const option=document.createElement("option");option.value=`${me}-${key}-${frame}`;option.textContent=`ME${me} Key${key}: Frame ${frame}`;valueSelect.appendChild(option)}}}break;case"HyperDeckRecord":case"HyperDeckStop":for(let hd=0;hd<4;hd++){const option=document.createElement("option");option.value=hd.toString();option.textContent=`HyperDeck ${hd}`;valueSelect.appendChild(option)}break;case"MacroSleep":["1","15","30","60","90","150","300"].forEach(frames=>{const option=document.createElement("option");option.value=frames;option.textContent=`${frames} frames (${Math.round(frames/30*1000)}ms)`;valueSelect.appendChild(option)});break}}

function updateStatus(message,isError=false){const statusBar=document.getElementById("statusBar");statusBar.textContent=message;statusBar.style.background=isError?"rgba(231, 76, 60, 0.2)":"rgba(255, 107, 53, 0.2)";setTimeout(()=>{statusBar.style.background="rgba(255, 255, 255, 0.1)"},3000)}

document.getElementById("commandType").addEventListener("change",updateCommandValueOptions);document.getElementById("renameModal").addEventListener("click",function(e){if(e.target===this){closeModal()}});document.getElementById("inputTemplatesModal").addEventListener("click",function(e){if(e.target===this){closeInputTemplatesModal()}});initializeApp();
    </script>
</body>
</html>